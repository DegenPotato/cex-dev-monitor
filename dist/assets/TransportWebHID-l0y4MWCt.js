var mt=Object.defineProperty;var $t=(r,t,e)=>t in r?mt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var L=(r,t,e)=>$t(r,typeof t!="symbol"?t+"":t,e);import{L as It,C as Rt,B as x,S as Se,d as b,f as we,h as gt,g as vt,i as Ne,l as Te,D as Lt,j as St}from"./index-Ck_jKyc7.js";import{p as wt}from"./index-BAMY2Nnw.js";const Nt="transport";class X{constructor({context:t,logType:e}={}){L(this,"exchangeTimeout",3e4);L(this,"unresponsiveTimeout",15e3);L(this,"deviceModel",null);L(this,"tracer");L(this,"_events",new Rt);L(this,"send",async(t,e,s,i,a=x.alloc(0),c=[Se.OK],{abortTimeoutMs:u}={})=>{const o=this.tracer.withUpdatedContext({function:"send"});if(a.length>=256)throw o.trace("data.length exceeded 256 bytes limit",{dataLength:a.length}),new b("data.length exceed 256 bytes limit. Got: "+a.length,"DataLengthTooBig");o.trace("Starting an exchange",{abortTimeoutMs:u});const $=await this.exchange(x.concat([x.from([t,e,s,i]),x.from([a.length]),a]),{abortTimeoutMs:u});o.trace("Received response from exchange");const n=$.readUInt16BE($.length-2);if(!c.some(E=>E===n))throw new we(n);return $});L(this,"exchangeBusyPromise");L(this,"_appAPIlock",null);this.tracer=new It(e??Nt,t)}exchange(t,{abortTimeoutMs:e}={}){throw new Error("exchange not implemented")}exchangeBulk(t,e){let s=!1;const i=()=>{s=!0};return(async()=>{if(!s)for(const c of t){const u=await this.exchange(c);if(s)return;const o=u.readUInt16BE(u.length-2);if(o!==Se.OK)throw new we(o);e.next(u)}})().then(()=>!s&&e.complete(),c=>!s&&e.error(c)),{unsubscribe:i}}setScrambleKey(t){}close(){return Promise.resolve()}on(t,e){this._events.on(t,e)}off(t,e){this._events.removeListener(t,e)}emit(t,...e){this._events.emit(t,...e)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(t){this.exchangeTimeout=t}setExchangeUnresponsiveTimeout(t){this.unresponsiveTimeout=t}static create(t=3e3,e){return new Promise((s,i)=>{let a=!1;const c=this.listen({next:o=>{a=!0,c&&c.unsubscribe(),u&&clearTimeout(u),this.open(o.descriptor,t).then(s,i)},error:o=>{u&&clearTimeout(u),i(o)},complete:()=>{u&&clearTimeout(u),a||i(new b(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=e?setTimeout(()=>{c.unsubscribe(),i(new b(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},e):null})}async exchangeAtomicImpl(t){const e=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw e.trace("Atomic exchange is already busy"),new gt("An action was already pending on the Ledger device. Please deny or reconnect.");let s;const i=new Promise(u=>{s=u});this.exchangeBusyPromise=i;let a=!1;const c=setTimeout(()=>{e.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),a=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const u=await t();return a&&(e.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),u}finally{e.trace("Finalize, clearing busy guard"),clearTimeout(c),s&&s(),this.exchangeBusyPromise=null}}decorateAppAPIMethods(t,e,s){for(const i of e)t[i]=this.decorateAppAPIMethod(i,t[i],t,s)}decorateAppAPIMethod(t,e,s,i){return async(...a)=>{const{_appAPIlock:c}=this;if(c)return Promise.reject(new b("Ledger Device is busy (lock "+c+")","TransportLocked"));try{return this._appAPIlock=t,this.setScrambleKey(i),await e.apply(s,a)}finally{this._appAPIlock=null}}}setTraceContext(t){this.tracer=this.tracer.withContext(t)}updateTraceContext(t){this.tracer.updateContext(t)}getTraceContext(){return this.tracer.getContext()}}L(X,"isSupported"),L(X,"list"),L(X,"listen"),L(X,"open"),L(X,"ErrorMessage_ListenTimeout","No Ledger device found (timeout)"),L(X,"ErrorMessage_NoDeviceFound","No Ledger device found");const Oe=5;function Tt(r){const t=x.alloc(2);return t.writeUInt16BE(r,0),t}const Ot={data:x.alloc(0),dataLength:0,sequence:0},At=(r,t)=>({makeBlocks(e){let s=x.concat([Tt(e.length),e]);const i=t-5,a=Math.ceil(s.length/i);s=x.concat([s,x.alloc(a*i-s.length+1).fill(0)]);const c=[];for(let u=0;u<a;u++){const o=x.alloc(5);o.writeUInt16BE(r,0),o.writeUInt8(Oe,2),o.writeUInt16BE(u,3);const $=s.slice(u*i,(u+1)*i);c.push(x.concat([o,$]))}return c},reduceResponse(e,s){let{data:i,dataLength:a,sequence:c}=e||Ot;if(s.readUInt16BE(0)!==r)throw new b("Invalid channel","InvalidChannel");if(s.readUInt8(2)!==Oe)throw new b("Invalid tag","InvalidTag");if(s.readUInt16BE(3)!==c)throw new b("Invalid sequence","InvalidSequence");e||(a=s.readUInt16BE(5)),c++;const u=s.slice(e?5:7);return i=x.concat([i,u]),i.length>a&&(i=i.slice(0,a)),{data:i,dataLength:a,sequence:c}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}});var fe={exports:{}};const yt="2.0.0",Je=256,Pt=Number.MAX_SAFE_INTEGER||9007199254740991,xt=16,Ct=Je-6,Ut=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var ee={MAX_LENGTH:Je,MAX_SAFE_COMPONENT_LENGTH:xt,MAX_SAFE_BUILD_LENGTH:Ct,MAX_SAFE_INTEGER:Pt,RELEASE_TYPES:Ut,SEMVER_SPEC_VERSION:yt,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},ie={};const _t=typeof wt=="object"&&ie&&ie.NODE_DEBUG&&/\bsemver\b/i.test(ie.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};var te=_t;(function(r,t){const{MAX_SAFE_COMPONENT_LENGTH:e,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:i}=ee,a=te;t=r.exports={};const c=t.re=[],u=t.safeRe=[],o=t.src=[],$=t.safeSrc=[],n=t.t={};let E=0;const S="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",i],[S,s]],B=G=>{for(const[C,k]of p)G=G.split(`${C}*`).join(`${C}{0,${k}}`).split(`${C}+`).join(`${C}{1,${k}}`);return G},R=(G,C,k)=>{const A=B(C),F=E++;a(G,F,C),n[G]=F,o[F]=C,$[F]=A,c[F]=new RegExp(C,k?"g":void 0),u[F]=new RegExp(A,k?"g":void 0)};R("NUMERICIDENTIFIER","0|[1-9]\\d*"),R("NUMERICIDENTIFIERLOOSE","\\d+"),R("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${S}*`),R("MAINVERSION",`(${o[n.NUMERICIDENTIFIER]})\\.(${o[n.NUMERICIDENTIFIER]})\\.(${o[n.NUMERICIDENTIFIER]})`),R("MAINVERSIONLOOSE",`(${o[n.NUMERICIDENTIFIERLOOSE]})\\.(${o[n.NUMERICIDENTIFIERLOOSE]})\\.(${o[n.NUMERICIDENTIFIERLOOSE]})`),R("PRERELEASEIDENTIFIER",`(?:${o[n.NONNUMERICIDENTIFIER]}|${o[n.NUMERICIDENTIFIER]})`),R("PRERELEASEIDENTIFIERLOOSE",`(?:${o[n.NONNUMERICIDENTIFIER]}|${o[n.NUMERICIDENTIFIERLOOSE]})`),R("PRERELEASE",`(?:-(${o[n.PRERELEASEIDENTIFIER]}(?:\\.${o[n.PRERELEASEIDENTIFIER]})*))`),R("PRERELEASELOOSE",`(?:-?(${o[n.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[n.PRERELEASEIDENTIFIERLOOSE]})*))`),R("BUILDIDENTIFIER",`${S}+`),R("BUILD",`(?:\\+(${o[n.BUILDIDENTIFIER]}(?:\\.${o[n.BUILDIDENTIFIER]})*))`),R("FULLPLAIN",`v?${o[n.MAINVERSION]}${o[n.PRERELEASE]}?${o[n.BUILD]}?`),R("FULL",`^${o[n.FULLPLAIN]}$`),R("LOOSEPLAIN",`[v=\\s]*${o[n.MAINVERSIONLOOSE]}${o[n.PRERELEASELOOSE]}?${o[n.BUILD]}?`),R("LOOSE",`^${o[n.LOOSEPLAIN]}$`),R("GTLT","((?:<|>)?=?)"),R("XRANGEIDENTIFIERLOOSE",`${o[n.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),R("XRANGEIDENTIFIER",`${o[n.NUMERICIDENTIFIER]}|x|X|\\*`),R("XRANGEPLAIN",`[v=\\s]*(${o[n.XRANGEIDENTIFIER]})(?:\\.(${o[n.XRANGEIDENTIFIER]})(?:\\.(${o[n.XRANGEIDENTIFIER]})(?:${o[n.PRERELEASE]})?${o[n.BUILD]}?)?)?`),R("XRANGEPLAINLOOSE",`[v=\\s]*(${o[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[n.XRANGEIDENTIFIERLOOSE]})(?:${o[n.PRERELEASELOOSE]})?${o[n.BUILD]}?)?)?`),R("XRANGE",`^${o[n.GTLT]}\\s*${o[n.XRANGEPLAIN]}$`),R("XRANGELOOSE",`^${o[n.GTLT]}\\s*${o[n.XRANGEPLAINLOOSE]}$`),R("COERCEPLAIN",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?`),R("COERCE",`${o[n.COERCEPLAIN]}(?:$|[^\\d])`),R("COERCEFULL",o[n.COERCEPLAIN]+`(?:${o[n.PRERELEASE]})?(?:${o[n.BUILD]})?(?:$|[^\\d])`),R("COERCERTL",o[n.COERCE],!0),R("COERCERTLFULL",o[n.COERCEFULL],!0),R("LONETILDE","(?:~>?)"),R("TILDETRIM",`(\\s*)${o[n.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",R("TILDE",`^${o[n.LONETILDE]}${o[n.XRANGEPLAIN]}$`),R("TILDELOOSE",`^${o[n.LONETILDE]}${o[n.XRANGEPLAINLOOSE]}$`),R("LONECARET","(?:\\^)"),R("CARETTRIM",`(\\s*)${o[n.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",R("CARET",`^${o[n.LONECARET]}${o[n.XRANGEPLAIN]}$`),R("CARETLOOSE",`^${o[n.LONECARET]}${o[n.XRANGEPLAINLOOSE]}$`),R("COMPARATORLOOSE",`^${o[n.GTLT]}\\s*(${o[n.LOOSEPLAIN]})$|^$`),R("COMPARATOR",`^${o[n.GTLT]}\\s*(${o[n.FULLPLAIN]})$|^$`),R("COMPARATORTRIM",`(\\s*)${o[n.GTLT]}\\s*(${o[n.LOOSEPLAIN]}|${o[n.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",R("HYPHENRANGE",`^\\s*(${o[n.XRANGEPLAIN]})\\s+-\\s+(${o[n.XRANGEPLAIN]})\\s*$`),R("HYPHENRANGELOOSE",`^\\s*(${o[n.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[n.XRANGEPLAINLOOSE]})\\s*$`),R("STAR","(<|>)?=?\\s*\\*"),R("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),R("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(fe,fe.exports);var q=fe.exports;const Dt=Object.freeze({loose:!0}),bt=Object.freeze({}),Gt=r=>r?typeof r!="object"?Dt:r:bt;var pe=Gt;const Ae=/^[0-9]+$/,Qe=(r,t)=>{if(typeof r=="number"&&typeof t=="number")return r===t?0:r<t?-1:1;const e=Ae.test(r),s=Ae.test(t);return e&&s&&(r=+r,t=+t),r===t?0:e&&!s?-1:s&&!e?1:r<t?-1:1},Ft=(r,t)=>Qe(t,r);var et={compareIdentifiers:Qe,rcompareIdentifiers:Ft};const H=te,{MAX_LENGTH:ye,MAX_SAFE_INTEGER:Y}=ee,{safeRe:W,t:K}=q,jt=pe,{compareIdentifiers:oe}=et;let kt=class D{constructor(t,e){if(e=jt(e),t instanceof D){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>ye)throw new TypeError(`version is longer than ${ye} characters`);H("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const s=t.trim().match(e.loose?W[K.LOOSE]:W[K.FULL]);if(!s)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>Y||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Y||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Y||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const a=+i;if(a>=0&&a<Y)return a}return i}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(H("SemVer.compare",this.version,this.options,t),!(t instanceof D)){if(typeof t=="string"&&t===this.version)return 0;t=new D(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof D||(t=new D(t,this.options)),this.major<t.major?-1:this.major>t.major?1:this.minor<t.minor?-1:this.minor>t.minor?1:this.patch<t.patch?-1:this.patch>t.patch?1:0}comparePre(t){if(t instanceof D||(t=new D(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const s=this.prerelease[e],i=t.prerelease[e];if(H("prerelease compare",e,s,i),s===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(s===void 0)return-1;if(s===i)continue;return oe(s,i)}while(++e)}compareBuild(t){t instanceof D||(t=new D(t,this.options));let e=0;do{const s=this.build[e],i=t.build[e];if(H("build compare",e,s,i),s===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(s===void 0)return-1;if(s===i)continue;return oe(s,i)}while(++e)}inc(t,e,s){if(t.startsWith("pre")){if(!e&&s===!1)throw new Error("invalid increment argument: identifier is empty");if(e){const i=`-${e}`.match(this.options.loose?W[K.PRERELEASELOOSE]:W[K.PRERELEASE]);if(!i||i[1]!==e)throw new Error(`invalid identifier: ${e}`)}}switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,s),this.inc("pre",e,s);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e,s),this.inc("pre",e,s);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(s)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(e===this.prerelease.join(".")&&s===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(e){let a=[e,i];s===!1&&(a=[e]),oe(this.prerelease[0],e)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var y=kt;const Pe=y,Xt=(r,t,e=!1)=>{if(r instanceof Pe)return r;try{return new Pe(r,t)}catch(s){if(!e)return null;throw s}};var V=Xt;const Vt=V,Bt=(r,t)=>{const e=Vt(r,t);return e?e.version:null};var Mt=Bt;const zt=V,qt=(r,t)=>{const e=zt(r.trim().replace(/^[=v]+/,""),t);return e?e.version:null};var Ht=qt;const xe=y,Yt=(r,t,e,s,i)=>{typeof e=="string"&&(i=s,s=e,e=void 0);try{return new xe(r instanceof xe?r.version:r,e).inc(t,s,i).version}catch{return null}};var Wt=Yt;const Ce=V,Kt=(r,t)=>{const e=Ce(r,null,!0),s=Ce(t,null,!0),i=e.compare(s);if(i===0)return null;const a=i>0,c=a?e:s,u=a?s:e,o=!!c.prerelease.length;if(!!u.prerelease.length&&!o){if(!u.patch&&!u.minor)return"major";if(u.compareMain(c)===0)return u.minor&&!u.patch?"minor":"patch"}const n=o?"pre":"";return e.major!==s.major?n+"major":e.minor!==s.minor?n+"minor":e.patch!==s.patch?n+"patch":"prerelease"};var Zt=Kt;const Jt=y,Qt=(r,t)=>new Jt(r,t).major;var er=Qt;const tr=y,rr=(r,t)=>new tr(r,t).minor;var sr=rr;const nr=y,ir=(r,t)=>new nr(r,t).patch;var or=ir;const ar=V,cr=(r,t)=>{const e=ar(r,t);return e&&e.prerelease.length?e.prerelease:null};var lr=cr;const Ue=y,ur=(r,t,e)=>new Ue(r,e).compare(new Ue(t,e));var U=ur;const hr=U,fr=(r,t,e)=>hr(t,r,e);var dr=fr;const Er=U,pr=(r,t)=>Er(r,t,!0);var mr=pr;const _e=y,$r=(r,t,e)=>{const s=new _e(r,e),i=new _e(t,e);return s.compare(i)||s.compareBuild(i)};var me=$r;const Ir=me,Rr=(r,t)=>r.sort((e,s)=>Ir(e,s,t));var gr=Rr;const vr=me,Lr=(r,t)=>r.sort((e,s)=>vr(s,e,t));var Sr=Lr;const wr=U,Nr=(r,t,e)=>wr(r,t,e)>0;var re=Nr;const Tr=U,Or=(r,t,e)=>Tr(r,t,e)<0;var $e=Or;const Ar=U,yr=(r,t,e)=>Ar(r,t,e)===0;var tt=yr;const Pr=U,xr=(r,t,e)=>Pr(r,t,e)!==0;var rt=xr;const Cr=U,Ur=(r,t,e)=>Cr(r,t,e)>=0;var Ie=Ur;const _r=U,Dr=(r,t,e)=>_r(r,t,e)<=0;var Re=Dr;const br=tt,Gr=rt,Fr=re,jr=Ie,kr=$e,Xr=Re,Vr=(r,t,e,s)=>{switch(t){case"===":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r===e;case"!==":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r!==e;case"":case"=":case"==":return br(r,e,s);case"!=":return Gr(r,e,s);case">":return Fr(r,e,s);case">=":return jr(r,e,s);case"<":return kr(r,e,s);case"<=":return Xr(r,e,s);default:throw new TypeError(`Invalid operator: ${t}`)}};var st=Vr;const Br=y,Mr=V,{safeRe:Z,t:J}=q,zr=(r,t)=>{if(r instanceof Br)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;t=t||{};let e=null;if(!t.rtl)e=r.match(t.includePrerelease?Z[J.COERCEFULL]:Z[J.COERCE]);else{const o=t.includePrerelease?Z[J.COERCERTLFULL]:Z[J.COERCERTL];let $;for(;($=o.exec(r))&&(!e||e.index+e[0].length!==r.length);)(!e||$.index+$[0].length!==e.index+e[0].length)&&(e=$),o.lastIndex=$.index+$[1].length+$[2].length;o.lastIndex=-1}if(e===null)return null;const s=e[2],i=e[3]||"0",a=e[4]||"0",c=t.includePrerelease&&e[5]?`-${e[5]}`:"",u=t.includePrerelease&&e[6]?`+${e[6]}`:"";return Mr(`${s}.${i}.${a}${c}${u}`,t)};var qr=zr;class Hr{constructor(){this.max=1e3,this.map=new Map}get(t){const e=this.map.get(t);if(e!==void 0)return this.map.delete(t),this.map.set(t,e),e}delete(t){return this.map.delete(t)}set(t,e){if(!this.delete(t)&&e!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,e)}return this}}var Yr=Hr,ae,De;function _(){if(De)return ae;De=1;const r=/\s+/g;class t{constructor(l,m){if(m=i(m),l instanceof t)return l.loose===!!m.loose&&l.includePrerelease===!!m.includePrerelease?l:new t(l.raw,m);if(l instanceof a)return this.raw=l.value,this.set=[[l]],this.formatted=void 0,this;if(this.options=m,this.loose=!!m.loose,this.includePrerelease=!!m.includePrerelease,this.raw=l.trim().replace(r," "),this.set=this.raw.split("||").map(f=>this.parseRange(f.trim())).filter(f=>f.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const f=this.set[0];if(this.set=this.set.filter(I=>!R(I[0])),this.set.length===0)this.set=[f];else if(this.set.length>1){for(const I of this.set)if(I.length===1&&G(I[0])){this.set=[I];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let l=0;l<this.set.length;l++){l>0&&(this.formatted+="||");const m=this.set[l];for(let f=0;f<m.length;f++)f>0&&(this.formatted+=" "),this.formatted+=m[f].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(l){const f=((this.options.includePrerelease&&p)|(this.options.loose&&B))+":"+l,I=s.get(f);if(I)return I;const d=this.options.loose,g=d?o[$.HYPHENRANGELOOSE]:o[$.HYPHENRANGE];l=l.replace(g,Et(this.options.includePrerelease)),c("hyphen replace",l),l=l.replace(o[$.COMPARATORTRIM],n),c("comparator trim",l),l=l.replace(o[$.TILDETRIM],E),c("tilde trim",l),l=l.replace(o[$.CARETTRIM],S),c("caret trim",l);let w=l.split(" ").map(O=>k(O,this.options)).join(" ").split(/\s+/).map(O=>dt(O,this.options));d&&(w=w.filter(O=>(c("loose invalid filter",O,this.options),!!O.match(o[$.COMPARATORLOOSE])))),c("range list",w);const v=new Map,N=w.map(O=>new a(O,this.options));for(const O of N){if(R(O))return[O];v.set(O.value,O)}v.size>1&&v.has("")&&v.delete("");const P=[...v.values()];return s.set(f,P),P}intersects(l,m){if(!(l instanceof t))throw new TypeError("a Range is required");return this.set.some(f=>C(f,m)&&l.set.some(I=>C(I,m)&&f.every(d=>I.every(g=>d.intersects(g,m)))))}test(l){if(!l)return!1;if(typeof l=="string")try{l=new u(l,this.options)}catch{return!1}for(let m=0;m<this.set.length;m++)if(pt(this.set[m],l,this.options))return!0;return!1}}ae=t;const e=Yr,s=new e,i=pe,a=se(),c=te,u=y,{safeRe:o,t:$,comparatorTrimReplace:n,tildeTrimReplace:E,caretTrimReplace:S}=q,{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:B}=ee,R=h=>h.value==="<0.0.0-0",G=h=>h.value==="",C=(h,l)=>{let m=!0;const f=h.slice();let I=f.pop();for(;m&&f.length;)m=f.every(d=>I.intersects(d,l)),I=f.pop();return m},k=(h,l)=>(h=h.replace(o[$.BUILD],""),c("comp",h,l),h=ct(h,l),c("caret",h),h=F(h,l),c("tildes",h),h=ut(h,l),c("xrange",h),h=ft(h,l),c("stars",h),h),A=h=>!h||h.toLowerCase()==="x"||h==="*",F=(h,l)=>h.trim().split(/\s+/).map(m=>at(m,l)).join(" "),at=(h,l)=>{const m=l.loose?o[$.TILDELOOSE]:o[$.TILDE];return h.replace(m,(f,I,d,g,w)=>{c("tilde",h,f,I,d,g,w);let v;return A(I)?v="":A(d)?v=`>=${I}.0.0 <${+I+1}.0.0-0`:A(g)?v=`>=${I}.${d}.0 <${I}.${+d+1}.0-0`:w?(c("replaceTilde pr",w),v=`>=${I}.${d}.${g}-${w} <${I}.${+d+1}.0-0`):v=`>=${I}.${d}.${g} <${I}.${+d+1}.0-0`,c("tilde return",v),v})},ct=(h,l)=>h.trim().split(/\s+/).map(m=>lt(m,l)).join(" "),lt=(h,l)=>{c("caret",h,l);const m=l.loose?o[$.CARETLOOSE]:o[$.CARET],f=l.includePrerelease?"-0":"";return h.replace(m,(I,d,g,w,v)=>{c("caret",h,I,d,g,w,v);let N;return A(d)?N="":A(g)?N=`>=${d}.0.0${f} <${+d+1}.0.0-0`:A(w)?d==="0"?N=`>=${d}.${g}.0${f} <${d}.${+g+1}.0-0`:N=`>=${d}.${g}.0${f} <${+d+1}.0.0-0`:v?(c("replaceCaret pr",v),d==="0"?g==="0"?N=`>=${d}.${g}.${w}-${v} <${d}.${g}.${+w+1}-0`:N=`>=${d}.${g}.${w}-${v} <${d}.${+g+1}.0-0`:N=`>=${d}.${g}.${w}-${v} <${+d+1}.0.0-0`):(c("no pr"),d==="0"?g==="0"?N=`>=${d}.${g}.${w}${f} <${d}.${g}.${+w+1}-0`:N=`>=${d}.${g}.${w}${f} <${d}.${+g+1}.0-0`:N=`>=${d}.${g}.${w} <${+d+1}.0.0-0`),c("caret return",N),N})},ut=(h,l)=>(c("replaceXRanges",h,l),h.split(/\s+/).map(m=>ht(m,l)).join(" ")),ht=(h,l)=>{h=h.trim();const m=l.loose?o[$.XRANGELOOSE]:o[$.XRANGE];return h.replace(m,(f,I,d,g,w,v)=>{c("xRange",h,f,I,d,g,w,v);const N=A(d),P=N||A(g),O=P||A(w),M=O;return I==="="&&M&&(I=""),v=l.includePrerelease?"-0":"",N?I===">"||I==="<"?f="<0.0.0-0":f="*":I&&M?(P&&(g=0),w=0,I===">"?(I=">=",P?(d=+d+1,g=0,w=0):(g=+g+1,w=0)):I==="<="&&(I="<",P?d=+d+1:g=+g+1),I==="<"&&(v="-0"),f=`${I+d}.${g}.${w}${v}`):P?f=`>=${d}.0.0${v} <${+d+1}.0.0-0`:O&&(f=`>=${d}.${g}.0${v} <${d}.${+g+1}.0-0`),c("xRange return",f),f})},ft=(h,l)=>(c("replaceStars",h,l),h.trim().replace(o[$.STAR],"")),dt=(h,l)=>(c("replaceGTE0",h,l),h.trim().replace(o[l.includePrerelease?$.GTE0PRE:$.GTE0],"")),Et=h=>(l,m,f,I,d,g,w,v,N,P,O,M)=>(A(f)?m="":A(I)?m=`>=${f}.0.0${h?"-0":""}`:A(d)?m=`>=${f}.${I}.0${h?"-0":""}`:g?m=`>=${m}`:m=`>=${m}${h?"-0":""}`,A(N)?v="":A(P)?v=`<${+N+1}.0.0-0`:A(O)?v=`<${N}.${+P+1}.0-0`:M?v=`<=${N}.${P}.${O}-${M}`:h?v=`<${N}.${P}.${+O+1}-0`:v=`<=${v}`,`${m} ${v}`.trim()),pt=(h,l,m)=>{for(let f=0;f<h.length;f++)if(!h[f].test(l))return!1;if(l.prerelease.length&&!m.includePrerelease){for(let f=0;f<h.length;f++)if(c(h[f].semver),h[f].semver!==a.ANY&&h[f].semver.prerelease.length>0){const I=h[f].semver;if(I.major===l.major&&I.minor===l.minor&&I.patch===l.patch)return!0}return!1}return!0};return ae}var ce,be;function se(){if(be)return ce;be=1;const r=Symbol("SemVer ANY");class t{static get ANY(){return r}constructor(n,E){if(E=e(E),n instanceof t){if(n.loose===!!E.loose)return n;n=n.value}n=n.trim().split(/\s+/).join(" "),c("comparator",n,E),this.options=E,this.loose=!!E.loose,this.parse(n),this.semver===r?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(n){const E=this.options.loose?s[i.COMPARATORLOOSE]:s[i.COMPARATOR],S=n.match(E);if(!S)throw new TypeError(`Invalid comparator: ${n}`);this.operator=S[1]!==void 0?S[1]:"",this.operator==="="&&(this.operator=""),S[2]?this.semver=new u(S[2],this.options.loose):this.semver=r}toString(){return this.value}test(n){if(c("Comparator.test",n,this.options.loose),this.semver===r||n===r)return!0;if(typeof n=="string")try{n=new u(n,this.options)}catch{return!1}return a(n,this.operator,this.semver,this.options)}intersects(n,E){if(!(n instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new o(n.value,E).test(this.value):n.operator===""?n.value===""?!0:new o(this.value,E).test(n.semver):(E=e(E),E.includePrerelease&&(this.value==="<0.0.0-0"||n.value==="<0.0.0-0")||!E.includePrerelease&&(this.value.startsWith("<0.0.0")||n.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&n.operator.startsWith(">")||this.operator.startsWith("<")&&n.operator.startsWith("<")||this.semver.version===n.semver.version&&this.operator.includes("=")&&n.operator.includes("=")||a(this.semver,"<",n.semver,E)&&this.operator.startsWith(">")&&n.operator.startsWith("<")||a(this.semver,">",n.semver,E)&&this.operator.startsWith("<")&&n.operator.startsWith(">")))}}ce=t;const e=pe,{safeRe:s,t:i}=q,a=st,c=te,u=y,o=_();return ce}const Wr=_(),Kr=(r,t,e)=>{try{t=new Wr(t,e)}catch{return!1}return t.test(r)};var ne=Kr;const Zr=_(),Jr=(r,t)=>new Zr(r,t).set.map(e=>e.map(s=>s.value).join(" ").trim().split(" "));var Qr=Jr;const es=y,ts=_(),rs=(r,t,e)=>{let s=null,i=null,a=null;try{a=new ts(t,e)}catch{return null}return r.forEach(c=>{a.test(c)&&(!s||i.compare(c)===-1)&&(s=c,i=new es(s,e))}),s};var ss=rs;const ns=y,is=_(),os=(r,t,e)=>{let s=null,i=null,a=null;try{a=new is(t,e)}catch{return null}return r.forEach(c=>{a.test(c)&&(!s||i.compare(c)===1)&&(s=c,i=new ns(s,e))}),s};var as=os;const le=y,cs=_(),Ge=re,ls=(r,t)=>{r=new cs(r,t);let e=new le("0.0.0");if(r.test(e)||(e=new le("0.0.0-0"),r.test(e)))return e;e=null;for(let s=0;s<r.set.length;++s){const i=r.set[s];let a=null;i.forEach(c=>{const u=new le(c.semver.version);switch(c.operator){case">":u.prerelease.length===0?u.patch++:u.prerelease.push(0),u.raw=u.format();case"":case">=":(!a||Ge(u,a))&&(a=u);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),a&&(!e||Ge(e,a))&&(e=a)}return e&&r.test(e)?e:null};var us=ls;const hs=_(),fs=(r,t)=>{try{return new hs(r,t).range||"*"}catch{return null}};var ds=fs;const Es=y,nt=se(),{ANY:ps}=nt,ms=_(),$s=ne,Fe=re,je=$e,Is=Re,Rs=Ie,gs=(r,t,e,s)=>{r=new Es(r,s),t=new ms(t,s);let i,a,c,u,o;switch(e){case">":i=Fe,a=Is,c=je,u=">",o=">=";break;case"<":i=je,a=Rs,c=Fe,u="<",o="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if($s(r,t,s))return!1;for(let $=0;$<t.set.length;++$){const n=t.set[$];let E=null,S=null;if(n.forEach(p=>{p.semver===ps&&(p=new nt(">=0.0.0")),E=E||p,S=S||p,i(p.semver,E.semver,s)?E=p:c(p.semver,S.semver,s)&&(S=p)}),E.operator===u||E.operator===o||(!S.operator||S.operator===u)&&a(r,S.semver))return!1;if(S.operator===o&&c(r,S.semver))return!1}return!0};var ge=gs;const vs=ge,Ls=(r,t,e)=>vs(r,t,">",e);var Ss=Ls;const ws=ge,Ns=(r,t,e)=>ws(r,t,"<",e);var Ts=Ns;const ke=_(),Os=(r,t,e)=>(r=new ke(r,e),t=new ke(t,e),r.intersects(t,e));var As=Os;const ys=ne,Ps=U;var xs=(r,t,e)=>{const s=[];let i=null,a=null;const c=r.sort((n,E)=>Ps(n,E,e));for(const n of c)ys(n,t,e)?(a=n,i||(i=n)):(a&&s.push([i,a]),a=null,i=null);i&&s.push([i,null]);const u=[];for(const[n,E]of s)n===E?u.push(n):!E&&n===c[0]?u.push("*"):E?n===c[0]?u.push(`<=${E}`):u.push(`${n} - ${E}`):u.push(`>=${n}`);const o=u.join(" || "),$=typeof t.raw=="string"?t.raw:String(t);return o.length<$.length?o:t};const Xe=_(),ve=se(),{ANY:ue}=ve,z=ne,Le=U,Cs=(r,t,e={})=>{if(r===t)return!0;r=new Xe(r,e),t=new Xe(t,e);let s=!1;e:for(const i of r.set){for(const a of t.set){const c=_s(i,a,e);if(s=s||c!==null,c)continue e}if(s)return!1}return!0},Us=[new ve(">=0.0.0-0")],Ve=[new ve(">=0.0.0")],_s=(r,t,e)=>{if(r===t)return!0;if(r.length===1&&r[0].semver===ue){if(t.length===1&&t[0].semver===ue)return!0;e.includePrerelease?r=Us:r=Ve}if(t.length===1&&t[0].semver===ue){if(e.includePrerelease)return!0;t=Ve}const s=new Set;let i,a;for(const p of r)p.operator===">"||p.operator===">="?i=Be(i,p,e):p.operator==="<"||p.operator==="<="?a=Me(a,p,e):s.add(p.semver);if(s.size>1)return null;let c;if(i&&a){if(c=Le(i.semver,a.semver,e),c>0)return null;if(c===0&&(i.operator!==">="||a.operator!=="<="))return null}for(const p of s){if(i&&!z(p,String(i),e)||a&&!z(p,String(a),e))return null;for(const B of t)if(!z(p,String(B),e))return!1;return!0}let u,o,$,n,E=a&&!e.includePrerelease&&a.semver.prerelease.length?a.semver:!1,S=i&&!e.includePrerelease&&i.semver.prerelease.length?i.semver:!1;E&&E.prerelease.length===1&&a.operator==="<"&&E.prerelease[0]===0&&(E=!1);for(const p of t){if(n=n||p.operator===">"||p.operator===">=",$=$||p.operator==="<"||p.operator==="<=",i){if(S&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===S.major&&p.semver.minor===S.minor&&p.semver.patch===S.patch&&(S=!1),p.operator===">"||p.operator===">="){if(u=Be(i,p,e),u===p&&u!==i)return!1}else if(i.operator===">="&&!z(i.semver,String(p),e))return!1}if(a){if(E&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===E.major&&p.semver.minor===E.minor&&p.semver.patch===E.patch&&(E=!1),p.operator==="<"||p.operator==="<="){if(o=Me(a,p,e),o===p&&o!==a)return!1}else if(a.operator==="<="&&!z(a.semver,String(p),e))return!1}if(!p.operator&&(a||i)&&c!==0)return!1}return!(i&&$&&!a&&c!==0||a&&n&&!i&&c!==0||S||E)},Be=(r,t,e)=>{if(!r)return t;const s=Le(r.semver,t.semver,e);return s>0?r:s<0||t.operator===">"&&r.operator===">="?t:r},Me=(r,t,e)=>{if(!r)return t;const s=Le(r.semver,t.semver,e);return s<0?r:s>0||t.operator==="<"&&r.operator==="<="?t:r};var Ds=Cs;const he=q,ze=ee,bs=y,qe=et,Gs=V,Fs=Mt,js=Ht,ks=Wt,Xs=Zt,Vs=er,Bs=sr,Ms=or,zs=lr,qs=U,Hs=dr,Ys=mr,Ws=me,Ks=gr,Zs=Sr,Js=re,Qs=$e,en=tt,tn=rt,rn=Ie,sn=Re,nn=st,on=qr,an=se(),cn=_(),ln=ne,un=Qr,hn=ss,fn=as,dn=us,En=ds,pn=ge,mn=Ss,$n=Ts,In=As,Rn=xs,gn=Ds;var vn={parse:Gs,valid:Fs,clean:js,inc:ks,diff:Xs,major:Vs,minor:Bs,patch:Ms,prerelease:zs,compare:qs,rcompare:Hs,compareLoose:Ys,compareBuild:Ws,sort:Ks,rsort:Zs,gt:Js,lt:Qs,eq:en,neq:tn,gte:rn,lte:sn,cmp:nn,coerce:on,Comparator:an,Range:cn,satisfies:ln,toComparators:un,maxSatisfying:hn,minSatisfying:fn,minVersion:dn,validRange:En,outside:pn,gtr:mn,ltr:$n,intersects:In,simplifyRange:Rn,subset:gn,SemVer:bs,re:he.re,src:he.src,tokens:he.t,SEMVER_SPEC_VERSION:ze.SEMVER_SPEC_VERSION,RELEASE_TYPES:ze.RELEASE_TYPES,compareIdentifiers:qe.compareIdentifiers,rcompareIdentifiers:qe.rcompareIdentifiers};const He=vt(vn);var T;(function(r){r.blue="blue",r.nanoS="nanoS",r.nanoSP="nanoSP",r.nanoX="nanoX",r.stax="stax",r.europa="europa",r.apex="apex"})(T||(T={}));const de={[T.blue]:{id:T.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:r=>4*1024},[T.nanoS]:{id:T.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:r=>He.lt(He.coerce(r)??"","2.0.0")?4*1024:2*1024},[T.nanoX]:{id:T.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:r=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[T.nanoSP]:{id:T.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:r=>32},[T.apex]:{id:T.apex,productName:"Ledger Apex",productIdMM:128,legacyUsbProductId:8,usbOnly:!1,memorySize:1533*1024,masks:[859832320],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-8004-0000-4c6564676572",notifyUuid:"13d63400-2c97-8004-0001-4c6564676572",writeUuid:"13d63400-2c97-8004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-8004-0003-4c6564676572"}]},[T.stax]:{id:T.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[T.europa]:{id:T.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};T.blue,T.nanoS,T.nanoSP,T.nanoX,T.stax,T.europa;const Ye=Object.values(de),it=11415,We=r=>{const t=Ye.find(i=>i.legacyUsbProductId===r);if(t)return t;const e=r>>8;return Ye.find(i=>i.productIdMM===e)},Ln=[],Ke={};for(const r in de){const t=de[r],{bluetoothSpec:e}=t;if(e)for(let s=0;s<e.length;s++){const i=e[s];Ln.push(i.serviceUuid),Ke[i.serviceUuid]=Ke[i.serviceUuid.replace(/-/g,"")]={deviceModel:t,...i}}}const Sn=[{vendorId:it}],wn=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),Q=()=>{const{hid:r}=navigator;if(!r)throw new b("navigator.hid is not supported","HIDNotSupported");return r};async function ot(){const r=await Q().requestDevice({filters:Sn});return Array.isArray(r)?r:[r]}async function Ee(){return(await Q().getDevices()).filter(t=>t.vendorId===it)}async function Nn(){const r=await Ee();return r.length>0?r[0]:(await ot())[0]}const j=class j extends X{constructor(e){super();L(this,"device");L(this,"deviceModel");L(this,"channel",Math.floor(Math.random()*65535));L(this,"packetSize",64);L(this,"inputs",[]);L(this,"inputCallback");L(this,"read",()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(e=>{this.inputCallback=e}));L(this,"onInputReport",e=>{const s=x.from(e.data.buffer);this.inputCallback?(this.inputCallback(s),this.inputCallback=null):this.inputs.push(s)});L(this,"_disconnectEmitted",!1);L(this,"_emitDisconnect",e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))});L(this,"exchange",async e=>await this.exchangeAtomicImpl(async()=>{const{channel:i,packetSize:a}=this;Te("apdu","=> "+e.toString("hex"));const c=At(i,a),u=c.makeBlocks(e);for(let n=0;n<u.length;n++)await this.device.sendReport(0,u[n]);let o,$;for(;!(o=c.getReducedResult($));)try{const n=await this.read();$=c.reduceResponse($,n)}catch(n){if(n instanceof b&&n.id==="InvalidChannel")continue;throw n}return Te("apdu","<= "+o.toString("hex")),o}).catch(i=>{throw i&&i.message&&i.message.includes("write")?(this._emitDisconnect(i),new Lt(i.message)):i}));this.device=e,this.deviceModel=typeof e.productId=="number"?We(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static async request(){const[e]=await ot();return j.open(e)}static async openConnected(){const e=await Ee();return e.length===0?null:j.open(e[0])}static async open(e){await e.open();const s=new j(e),i=a=>{e===a.device&&(Q().removeEventListener("disconnect",i),s._emitDisconnect(new St))};return Q().addEventListener("disconnect",i),s}async close(){await this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),await this.device.close()}setScrambleKey(){}};L(j,"isSupported",wn),L(j,"list",Ee),L(j,"listen",e=>{let s=!1;Nn().then(a=>{if(!a)e.error(new Ne("Access denied to use Ledger device"));else if(!s){const c=typeof a.productId=="number"?We(a.productId):void 0;e.next({type:"add",descriptor:a,deviceModel:c}),e.complete()}},a=>{e.error(new Ne(a.message))});function i(){s=!0}return{unsubscribe:i}});let Ze=j;export{Ze as default};
